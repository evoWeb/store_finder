/*! For license information please see FrontendGoogleMap.min.js.LICENSE.txt */
(()=>{"use strict";var t=Object.prototype.toString,e=Array.isArray||function(e){return"[object Array]"===t.call(e)};function n(t){return"function"==typeof t}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return null!=t&&"object"==typeof t&&e in t}var r=RegExp.prototype.test,a=/\S/;var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},l=/\s*/,c=/\s+/,p=/\s*=/,h=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function u(t){this.string=t,this.tail=t,this.pos=0}function g(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function d(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}u.prototype.eos=function(){return""===this.tail},u.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},u.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},g.prototype.push=function(t){return new g(t,this)},g.prototype.lookup=function(t){var e,i,r,a=this.cache;if(a.hasOwnProperty(t))e=a[t];else{for(var s,l,c,p=this,h=!1;p;){if(t.indexOf(".")>0)for(s=p.view,l=t.split("."),c=0;null!=s&&c<l.length;)c===l.length-1&&(h=o(s,l[c])||(i=s,r=l[c],null!=i&&"object"!=typeof i&&i.hasOwnProperty&&i.hasOwnProperty(r))),s=s[l[c++]];else s=p.view[t],h=o(p.view,t);if(h){e=s;break}p=p.parent}a[t]=e}return n(e)&&(e=e.call(this.view)),e},d.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},d.prototype.parse=function(t,n){var o=this.templateCache,s=t+":"+(n||m.tags).join(":"),g=void 0!==o,d=g?o.get(s):void 0;return null==d&&(d=function(t,n){if(!t)return[];var o,s,g,d,w=!1,v=[],y=[],C=[],k=!1,b=!1,I="",L=0;function x(){if(k&&!b)for(;C.length;)delete y[C.pop()];else C=[];k=!1,b=!1}function W(t){if("string"==typeof t&&(t=t.split(c,2)),!e(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(i(t[0])+"\\s*"),s=new RegExp("\\s*"+i(t[1])),g=new RegExp("\\s*"+i("}"+t[1]))}W(n||m.tags);for(var T,E,S,z,M,O,P=new u(t);!P.eos();){if(T=P.pos,S=P.scanUntil(o))for(var U=0,j=S.length;U<j;++U)d=z=S.charAt(U),function(t,e){return r.call(t,e)}(a,d)?(b=!0,w=!0,I+=" "):(C.push(y.length),I+=z),y.push(["text",z,T,T+1]),T+=1,"\n"===z&&(x(),I="",L=0,w=!1);if(!P.scan(o))break;if(k=!0,E=P.scan(f)||"name",P.scan(l),"="===E?(S=P.scanUntil(p),P.scan(p),P.scanUntil(s)):"{"===E?(S=P.scanUntil(g),P.scan(h),P.scanUntil(s),E="&"):S=P.scanUntil(s),!P.scan(s))throw new Error("Unclosed tag at "+P.pos);if(M=">"==E?[E,S,T,P.pos,I,L,w]:[E,S,T,P.pos],L++,y.push(M),"#"===E||"^"===E)v.push(M);else if("/"===E){if(!(O=v.pop()))throw new Error('Unopened section "'+S+'" at '+T);if(O[1]!==S)throw new Error('Unclosed section "'+O[1]+'" at '+T)}else"name"===E||"{"===E||"&"===E?b=!0:"="===E&&W(S)}if(x(),O=v.pop())throw new Error('Unclosed section "'+O[1]+'" at '+P.pos);return function(t){for(var e,n=[],i=n,o=[],r=0,a=t.length;r<a;++r)switch((e=t[r])[0]){case"#":case"^":i.push(e),o.push(e),i=e[4]=[];break;case"/":o.pop()[5]=e[2],i=o.length>0?o[o.length-1][4]:n;break;default:i.push(e)}return n}(function(t){for(var e,n,i=[],o=0,r=t.length;o<r;++o)(e=t[o])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}(y))}(t,n),g&&o.set(s,d)),d},d.prototype.render=function(t,e,n,i){var o=this.getConfigTags(i),r=this.parse(t,o),a=e instanceof g?e:new g(e,void 0);return this.renderTokens(r,a,n,t,i)},d.prototype.renderTokens=function(t,e,n,i,o){for(var r,a,s,l="",c=0,p=t.length;c<p;++c)s=void 0,"#"===(a=(r=t[c])[0])?s=this.renderSection(r,e,n,i,o):"^"===a?s=this.renderInverted(r,e,n,i,o):">"===a?s=this.renderPartial(r,e,n,o):"&"===a?s=this.unescapedValue(r,e):"name"===a?s=this.escapedValue(r,e,o):"text"===a&&(s=this.rawValue(r)),void 0!==s&&(l+=s);return l},d.prototype.renderSection=function(t,i,o,r,a){var s=this,l="",c=i.lookup(t[1]);if(c){if(e(c))for(var p=0,h=c.length;p<h;++p)l+=this.renderTokens(t[4],i.push(c[p]),o,r,a);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)l+=this.renderTokens(t[4],i.push(c),o,r,a);else if(n(c)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(i.view,r.slice(t[3],t[5]),(function(t){return s.render(t,i,o,a)})))&&(l+=c)}else l+=this.renderTokens(t[4],i,o,r,a);return l}},d.prototype.renderInverted=function(t,n,i,o,r){var a=n.lookup(t[1]);if(!a||e(a)&&0===a.length)return this.renderTokens(t[4],n,i,o,r)},d.prototype.indentPartial=function(t,e,n){for(var i=e.replace(/[^ \t]/g,""),o=t.split("\n"),r=0;r<o.length;r++)o[r].length&&(r>0||!n)&&(o[r]=i+o[r]);return o.join("\n")},d.prototype.renderPartial=function(t,e,i,o){if(i){var r=this.getConfigTags(o),a=n(i)?i(t[1]):i[t[1]];if(null!=a){var s=t[6],l=t[5],c=t[4],p=a;0==l&&c&&(p=this.indentPartial(a,c,s));var h=this.parse(p,r);return this.renderTokens(h,e,i,p,o)}}},d.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},d.prototype.escapedValue=function(t,e,n){var i=this.getConfigEscape(n)||m.escape,o=e.lookup(t[1]);if(null!=o)return"number"==typeof o&&i===m.escape?String(o):i(o)},d.prototype.rawValue=function(t){return t[1]},d.prototype.getConfigTags=function(t){return e(t)?t:t&&"object"==typeof t?t.tags:void 0},d.prototype.getConfigEscape=function(t){return t&&"object"==typeof t&&!e(t)?t.escape:void 0};var m={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){w.templateCache=t},get templateCache(){return w.templateCache}},w=new d;m.clearCache=function(){return w.clearCache()},m.parse=function(t,e){return w.parse(t,e)},m.render=function(t,n,i,o){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+(e(r=t)?"array":typeof r)+'" was given as the first argument for mustache#render(template, view, partials)');var r;return w.render(t,n,i,o)},m.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,(function(t){return s[t]}))},m.Scanner=u,m.Context=g,m.Writer=d;const v=m;class y{constructor(){this.mapConfiguration={active:!1,afterSearch:0,center:{lat:0,lng:0},zoom:18,apiConsoleKey:"",apiUrl:"",language:"",markerIcon:"",apiV3Layers:"",kmlUrl:"",renderSingleViewCallback:null,handleCloseButtonCallback:null},this.locations=[],this.locationIndex=0,this.infoWindowTemplate="","object"==typeof window.mapConfiguration&&window.mapConfiguration.active&&(this.mapConfiguration=window.mapConfiguration),this.mapConfiguration.active&&("object"==typeof window.locations&&(this.locations=window.locations),this.loadScript())}initializeMap(){}initializeLayer(){}renderInfoWindowContent(t){return v.render(this.infoWindowTemplate,t.information)}createMarker(t,e){}removeMarker(t){console.log(t,"removeMarker should be overridden")}removeLocation(t){this.removeMarker(t);const e=this.locations.indexOf(t);e>-1&&this.locations.splice(e,1)}processLocation(t){let e="";t.information.icon?e=t.information.icon:Object.prototype.hasOwnProperty.call(this.mapConfiguration,"markerIcon")&&(e=this.mapConfiguration.markerIcon),this.locationIndex++,t.information.index=this.locationIndex,t.marker=this.createMarker(t,e)}initializeLocations(){this.locations.map(this.processLocation.bind(this))}initializeInfoWindow(){}closeInfoWindow(){}openInfoWindow(t){}initializeListEvents(){document.addEventListener("click",(t=>{const e=t.target;e.matches(".tx-storefinder .resultList > li")&&this.openInfoWindow(parseInt(e.dataset.index,10))}))}initializeTemplates(){this.infoWindowTemplate=document.getElementById("templateInfoWindow").innerHTML,v.parse(this.infoWindowTemplate),document.addEventListener("click",(t=>{const e=t.target;e.matches(".tx-storefinder .infoWindow .close")&&("function"==typeof this.mapConfiguration.renderSingleViewCallback?this.mapConfiguration.handleCloseButtonCallback(e):this.closeInfoWindow())}))}postLoadScript(){this.initializeMap(),this.initializeLayer(),this.initializeLocations(),this.initializeInfoWindow(),this.initializeTemplates(),this.initializeListEvents()}createFilePromise(t,e="",n=""){return new Promise(((i,o)=>{let r;t.match(/\.css/)?(r=document.createElement("link"),r.rel="stylesheet",r.href=t):(r=document.createElement("script"),r.src=t),e.length>0&&(r.integrity=e),n.length>0&&(r.crossOrigin=n),r.onload=()=>{i(t)},r.onerror=()=>{o(t)},document.head.appendChild(r)}))}loadScript(){}}new class extends y{initializeMap(){let t;t=void 0!==this.mapConfiguration.center?new google.maps.LatLng(this.mapConfiguration.center.lat,this.mapConfiguration.center.lng):new google.maps.LatLng(0,0);const e={zoom:this.mapConfiguration.zoom,center:t,disableDefaultUI:!0,zoomControl:!0,styles:[],zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM}};self.mapConfiguration.mapStyles&&(e.styles=self.mapConfiguration.mapStyles),this.map=new google.maps.Map(document.getElementById("tx_storefinder_map"),e),0===this.mapConfiguration.afterSearch&&navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{const e={lat:t.coords.latitude,lng:t.coords.longitude};this.map.setCenter(e)}))}initializeLayer(){this.mapConfiguration.apiV3Layers.indexOf("traffic")>-1&&(new google.maps.TrafficLayer).setMap(this.map),this.mapConfiguration.apiV3Layers.indexOf("bicycling")>-1&&(new google.maps.BicyclingLayer).setMap(this.map),this.mapConfiguration.apiV3Layers.indexOf("kml")>-1&&new google.maps.KmlLayer({url:this.mapConfiguration.kmlUrl}).setMap(this.map)}showInformation(t,e){"function"==typeof this.mapConfiguration.renderSingleViewCallback?this.mapConfiguration.renderSingleViewCallback(t,this.infoWindowTemplate):(this.infoWindow.close(),this.infoWindow.setContent(this.renderInfoWindowContent(t)),this.infoWindow.setPosition(e.getPosition()),this.infoWindow.open(this.map,e))}createMarker(t,e){const n={title:t.name,position:new google.maps.LatLng(t.lat,t.lng),icon:e},i=new google.maps.Marker(n);return i.setMap(this.map),i.addListener("click",(()=>{this.showInformation(t,i)})),i}initializeInfoWindow(){this.infoWindow=new google.maps.InfoWindow}closeInfoWindow(){this.infoWindow.close()}openInfoWindow(t){google.maps.event.trigger(this.locations[t].marker,"click")}loadScript(){let t="https://maps.googleapis.com/maps/api/js?v=3.exp",e="&key="+this.mapConfiguration.apiConsoleKey;""!==this.mapConfiguration.language&&(e+="&language="+this.mapConfiguration.language),Object.prototype.hasOwnProperty.call(this.mapConfiguration,"apiUrl")&&(t=this.mapConfiguration.apiUrl),Promise.all([this.createFilePromise(t+e)]).then((()=>{const t=()=>{"undefined"!=typeof google?this.postLoadScript():window.requestAnimationFrame(t)};window.requestAnimationFrame(t)})).catch((()=>{console.log("Failed loading resources.")}))}}})();
//# sourceMappingURL=FrontendGoogleMap.min.js.map