import*as t from"@evoweb/store-finder/leaflet/leaflet-src.esm.js";class i{constructor(t){this.mapConfiguration={uid:"0",mapId:"",latitude:0,longitude:0,zoom:16},this.mapConfiguration=t,this.initializeFields(),this.initializeMap(),this.initializeMarker(),this.initializeEvents(),this.resizeMap()}initializeFields(){const t="data[tx_storefinder_domain_model_location]["+this.mapConfiguration.uid+"]";this.latitudeField=document.querySelector('[data-formengine-input-name="'+t+'[latitude]"]'),this.longitudeField=document.querySelector('[data-formengine-input-name="'+t+'[longitude]"]')}initializeMap(){this.map=t.map(this.mapConfiguration.mapId),this.map.setView(new t.LatLng(this.mapConfiguration.latitude,this.mapConfiguration.longitude),this.mapConfiguration.zoom),this.map.doubleClickZoom.disable(),t.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',minZoom:8}).addTo(this.map)}initializeMarker(){this.marker=new t.Marker(new t.LatLng(this.mapConfiguration.latitude,this.mapConfiguration.longitude),{draggable:!0}),this.marker.bindPopup("").addTo(this.map)}initializeEvents(){let t=document.querySelector("#"+this.mapConfiguration.mapId);for(;(t=t.parentElement)&&"body"!=t.tagName&&!t.matches(".tab-pane"););[...document.querySelectorAll(".t3js-tabmenu-item a")].forEach((i=>{i.addEventListener("click",(i=>{t.id===i.target.getAttribute("aria-controls")&&this.resizeMap()}))})),this.map.on("dblclick",(t=>{const i=t.latlng;this.marker.setLatLng(i),this.updateCoordinateFields(i)})),this.marker.on("moveend",(t=>{const i=t.target.getLatLng();this.updateCoordinateFields(i)}))}updateCoordinateFields(t){this.latitudeField.value=t.lat.toString(),this.latitudeField.dispatchEvent(new Event("change",{bubbles:!0})),this.longitudeField.value=t.lng.toString(),this.longitudeField.dispatchEvent(new Event("change",{bubbles:!0}))}resizeMap(){setTimeout((()=>{this.map.invalidateSize()}),10)}}export{i as default};
