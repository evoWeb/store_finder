{"version":3,"file":"backend-osm-map.js.map","sources":["../../../../../Build/Public/form-engine/element/backend-osm-map.js"],"sourcesContent":["/**\n * This file is developed by evoWeb.\n *\n * It is free software; you can redistribute it and/or modify it under\n * the terms of the GNU General Public License, either version 2\n * of the License, or any later version.\n *\n * For the full copyright and license information, please read the\n * LICENSE.txt file that was distributed with this source code.\n */\nimport * as L from '@evoweb/store-finder/leaflet/leaflet-src.esm.js';\nexport default class BackendOsmMap {\n    constructor(mapConfiguration) {\n        this.mapConfiguration = {\n            uid: '0',\n            mapId: '',\n            latitude: 0,\n            longitude: 0,\n            zoom: 16\n        };\n        this.mapConfiguration = mapConfiguration;\n        this.initializeFields();\n        this.initializeMap();\n        this.initializeMarker();\n        this.initializeEvents();\n        this.resizeMap();\n    }\n    initializeFields() {\n        const fieldPrefix = 'data[tx_storefinder_domain_model_location][' + this.mapConfiguration.uid + ']';\n        this.latitudeField = document.querySelector('[data-formengine-input-name=\"' + fieldPrefix + '[latitude]\"]');\n        this.longitudeField = document.querySelector('[data-formengine-input-name=\"' + fieldPrefix + '[longitude]\"]');\n    }\n    initializeMap() {\n        this.map = L.map(this.mapConfiguration.mapId);\n        this.map.setView(new L.LatLng(this.mapConfiguration.latitude, this.mapConfiguration.longitude), this.mapConfiguration.zoom);\n        this.map.doubleClickZoom.disable();\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n            attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n            minZoom: 8\n        }).addTo(this.map);\n    }\n    initializeMarker() {\n        const options = {\n            draggable: true\n        };\n        this.marker = new L.Marker(new L.LatLng(this.mapConfiguration.latitude, this.mapConfiguration.longitude), options);\n        this.marker.bindPopup('').addTo(this.map);\n    }\n    initializeEvents() {\n        let mapParentTab = document.querySelector('#' + this.mapConfiguration.mapId);\n        while ((mapParentTab = mapParentTab.parentElement) && mapParentTab.tagName != 'body') {\n            if (mapParentTab.matches('.tab-pane')) {\n                break;\n            }\n        }\n        [...document.querySelectorAll('.t3js-tabmenu-item a')].forEach(tab => {\n            tab.addEventListener('click', (event) => {\n                if (mapParentTab.id === event.target.getAttribute('aria-controls')) {\n                    this.resizeMap();\n                }\n            });\n        });\n        this.map.on('dblclick', (event) => {\n            const coordinates = event.latlng;\n            this.marker.setLatLng(coordinates);\n            this.updateCoordinateFields(coordinates);\n        });\n        this.marker.on('moveend', (event) => {\n            const coordinates = event.target.getLatLng();\n            this.updateCoordinateFields(coordinates);\n        });\n    }\n    updateCoordinateFields(coordinates) {\n        this.latitudeField.value = coordinates.lat.toString();\n        this.latitudeField.dispatchEvent(new Event('change', { bubbles: true }));\n        this.longitudeField.value = coordinates.lng.toString();\n        this.longitudeField.dispatchEvent(new Event('change', { bubbles: true }));\n    }\n    resizeMap() {\n        setTimeout(() => { this.map.invalidateSize(); }, 10);\n    }\n}\n"],"names":[],"mappings":"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"}