{"version":3,"file":"backend-osm-map.min.js.map","sources":["../../../../../Build/Public/form-engine/element/backend-osm-map.js"],"sourcesContent":["/**\n * This file is developed by evoWeb.\n *\n * It is free software; you can redistribute it and/or modify it under\n * the terms of the GNU General Public License, either version 2\n * of the License, or any later version.\n *\n * For the full copyright and license information, please read the\n * LICENSE.txt file that was distributed with this source code.\n */\nimport * as L from '@evoweb/store-finder/leaflet/leaflet-src.esm.js';\nexport default class BackendOsmMap {\n    constructor(mapConfiguration) {\n        this.mapConfiguration = {\n            uid: '0',\n            mapId: '',\n            latitude: 0,\n            longitude: 0,\n            zoom: 16\n        };\n        this.mapConfiguration = mapConfiguration;\n        this.initializeFields();\n        this.initializeMap();\n        this.initializeMarker();\n        this.initializeEvents();\n        this.resizeMap();\n    }\n    initializeFields() {\n        const fieldPrefix = 'data[tx_storefinder_domain_model_location][' + this.mapConfiguration.uid + ']';\n        this.latitudeField = document.querySelector('[data-formengine-input-name=\"' + fieldPrefix + '[latitude]\"]');\n        this.longitudeField = document.querySelector('[data-formengine-input-name=\"' + fieldPrefix + '[longitude]\"]');\n    }\n    initializeMap() {\n        this.map = L.map(this.mapConfiguration.mapId);\n        this.map.setView(new L.LatLng(this.mapConfiguration.latitude, this.mapConfiguration.longitude), this.mapConfiguration.zoom);\n        this.map.doubleClickZoom.disable();\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n            attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n            minZoom: 8\n        }).addTo(this.map);\n    }\n    initializeMarker() {\n        const options = {\n            draggable: true\n        };\n        this.marker = new L.Marker(new L.LatLng(this.mapConfiguration.latitude, this.mapConfiguration.longitude), options);\n        this.marker.bindPopup('').addTo(this.map);\n    }\n    initializeEvents() {\n        let mapParentTab = document.querySelector('#' + this.mapConfiguration.mapId);\n        while ((mapParentTab = mapParentTab.parentElement) && mapParentTab.tagName != 'body') {\n            if (mapParentTab.matches('.tab-pane')) {\n                break;\n            }\n        }\n        [...document.querySelectorAll('.t3js-tabmenu-item a')].forEach(tab => {\n            tab.addEventListener('click', (event) => {\n                if (mapParentTab.id === event.target.getAttribute('aria-controls')) {\n                    this.resizeMap();\n                }\n            });\n        });\n        this.map.on('dblclick', (event) => {\n            const coordinates = event.latlng;\n            this.marker.setLatLng(coordinates);\n            this.updateCoordinateFields(coordinates);\n        });\n        this.marker.on('moveend', (event) => {\n            const coordinates = event.target.getLatLng();\n            this.updateCoordinateFields(coordinates);\n        });\n    }\n    updateCoordinateFields(coordinates) {\n        this.latitudeField.value = coordinates.lat.toString();\n        this.latitudeField.dispatchEvent(new Event('change', { bubbles: true }));\n        this.longitudeField.value = coordinates.lng.toString();\n        this.longitudeField.dispatchEvent(new Event('change', { bubbles: true }));\n    }\n    resizeMap() {\n        setTimeout(() => { this.map.invalidateSize(); }, 10);\n    }\n}\n"],"names":["L","BackendOsmMap","constructor","mapConfiguration","this","uid","mapId","latitude","longitude","zoom","initializeFields","initializeMap","initializeMarker","initializeEvents","resizeMap","fieldPrefix","latitudeField","document","querySelector","longitudeField","map","setView","LatLng","doubleClickZoom","disable","tileLayer","attribution","minZoom","addTo","marker","Marker","draggable","bindPopup","mapParentTab","parentElement","tagName","matches","querySelectorAll","forEach","tab","addEventListener","event","id","target","getAttribute","on","coordinates","latlng","setLatLng","updateCoordinateFields","getLatLng","value","lat","toString","dispatchEvent","Event","bubbles","lng","setTimeout","invalidateSize"],"mappings":"UAAAA,MAAA,kDAWe,MAAMC,EACjB,WAAAC,CAAYC,GACRC,KAAKD,iBAAmB,CACpBE,IAAK,IACLC,MAAO,GACPC,SAAU,EACVC,UAAW,EACXC,KAAM,IAEVL,KAAKD,iBAAmBA,EACxBC,KAAKM,mBACLN,KAAKO,gBACLP,KAAKQ,mBACLR,KAAKS,mBACLT,KAAKU,WACb,CACI,gBAAAJ,GACI,MAAMK,EAAc,8CAAgDX,KAAKD,iBAAiBE,IAAM,IAChGD,KAAKY,cAAgBC,SAASC,cAAc,gCAAkCH,EAAc,gBAC5FX,KAAKe,eAAiBF,SAASC,cAAc,gCAAkCH,EAAc,gBACrG,CACI,aAAAJ,GACIP,KAAKgB,IAAMpB,EAAEoB,IAAIhB,KAAKD,iBAAiBG,OACvCF,KAAKgB,IAAIC,QAAQ,IAAIrB,EAAEsB,OAAOlB,KAAKD,iBAAiBI,SAAUH,KAAKD,iBAAiBK,WAAYJ,KAAKD,iBAAiBM,MACtHL,KAAKgB,IAAIG,gBAAgBC,UACzBxB,EAAEyB,UAAU,qDAAsD,CAC9DC,YAAa,6EACbC,QAAS,IACVC,MAAMxB,KAAKgB,IACtB,CACI,gBAAAR,GAIIR,KAAKyB,OAAS,IAAI7B,EAAE8B,OAAO,IAAI9B,EAAEsB,OAAOlB,KAAKD,iBAAiBI,SAAUH,KAAKD,iBAAiBK,WAH9E,CACZuB,WAAW,IAGf3B,KAAKyB,OAAOG,UAAU,IAAIJ,MAAMxB,KAAKgB,IAC7C,CACI,gBAAAP,GACI,IAAIoB,EAAehB,SAASC,cAAc,IAAMd,KAAKD,iBAAiBG,OACtE,MAAQ2B,EAAeA,EAAaC,gBAA0C,QAAxBD,EAAaE,UAC3DF,EAAaG,QAAQ,eAI7B,IAAInB,SAASoB,iBAAiB,yBAAyBC,SAAQC,IAC3DA,EAAIC,iBAAiB,SAAUC,IACvBR,EAAaS,KAAOD,EAAME,OAAOC,aAAa,kBAC9CxC,KAAKU,WACzB,GACc,IAENV,KAAKgB,IAAIyB,GAAG,YAAaJ,IACrB,MAAMK,EAAcL,EAAMM,OAC1B3C,KAAKyB,OAAOmB,UAAUF,GACtB1C,KAAK6C,uBAAuBH,EAAY,IAE5C1C,KAAKyB,OAAOgB,GAAG,WAAYJ,IACvB,MAAMK,EAAcL,EAAME,OAAOO,YACjC9C,KAAK6C,uBAAuBH,EAAY,GAEpD,CACI,sBAAAG,CAAuBH,GACnB1C,KAAKY,cAAcmC,MAAQL,EAAYM,IAAIC,WAC3CjD,KAAKY,cAAcsC,cAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,KAChEpD,KAAKe,eAAegC,MAAQL,EAAYW,IAAIJ,WAC5CjD,KAAKe,eAAemC,cAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,IACzE,CACI,SAAA1C,GACI4C,YAAW,KAAQtD,KAAKgB,IAAIuC,gBAAgB,GAAK,GACzD,SACA1D"}