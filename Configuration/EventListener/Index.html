<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <title>Event listener documentation</title>

    
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="phpdocumentor/guides" name="generator">
<meta content="" name="docsearch:name">
<meta content="" name="docsearch:package_type">
<meta content="" name="docsearch:release">
<meta content="" name="docsearch:version">
<meta content="2024-10-03T11:16:57+00:00" name="docsearch:modified">
<meta content="2024-10-03T11:16:57+00:00" name="dc.modified">
<meta content="2024-10-03T11:16:57+00:00" property="article:modified_time">
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.dc">
<link href="../../_resources/css/theme.css" rel="stylesheet">
<link href="https://docs.typo3.org/search/" rel="search" title="Search">
<script src="https://typo3.azureedge.net/typo3infrastructure/universe/dist/webcomponents-loader.js"></script>
<script src="https://typo3.azureedge.net/typo3infrastructure/universe/dist/typo3-universe.js" type="module"></script>
                        <link href="../Geocoding/Index.html" rel="prev" title="Geocoding provider"/>
            <link href="../../Templating/Index.html" rel="next" title="Templating"/>
            <link href="../../Index.html" rel="top" title="Store finder"/>
    </head>
<body>
<div class="page">
    
<header>
    <div class="page-topbar">
        <div class="page-topbar-inner">
            <typo3-universe active="documentation">
                <div style="display: block; height: 44px; background-color: #313131;"></div>
            </typo3-universe>
        </div>
    </div>
    <div class="page-header">
        <div class="page-header-inner">
            <div class="row">
                <div class="col-sm-3 col-md-4 col-lg-6">
                    <a class="logo" href="https://docs.typo3.org/" title="TYPO3 Documentation">
                        <img alt="TYPO3 Logo" class="logo-image" src="../../_resources/img/typo3-logo.svg" width="484" height="130">
                    </a>
                </div>
                <div class="col-sm-9 col-md-8 col-lg-6">
                    <search role="search">
                        <form action="https://docs.typo3.org/search/search" id="global-search-form" method="get">
			                <div class="sr-only"><label for="globalsearchinput">TYPO3 documentation...</label></div>
                            <div class="input-group mb-3 mt-sm-3">
                                <select class="form-select search__scope" id="searchscope" name="scope">
                                    <option value="">Search all</option>
                                </select>
                                <input autocomplete="off" class="form-control shadow-none" id="globalsearchinput" name="q" placeholder="TYPO3 documentation..." type="text" value="">
                                <button class="btn btn-light search__submit" type="submit"><i class="fa fa-search"></i>&nbsp;<span class="d-none d-md-inline">Search</span></button>
                            </div>
                        </form>
                    </search>
                </div>
            </div>
        </div>
    </div>
</header>    <main class="page-main">
        <div class="page-main-inner">
            <div class="page-main-navigation">
                <nav>
                    <input class="toc-checkbox" id="toggleToc" type="checkbox">

                    
<div class="toc-header">
    <div class="toc-title">
        <a class="toc-title-project" href="../../Index.html"></a>
            </div>
    <div class="toc-actions">
        <label class="toc-toggle" for="toggleToc">
            Menu
        </label>
    </div>
</div>                    <div class="toc-collapse">
                                                <div aria-label="main navigation" class="toc" role="navigation">
                                <div aria-label="Main navigation" class="main_menu" role="navigation">
        
    <ul class="menu-level-1">
    <li class="">
    <a href="../../Introduction/Index.html">
        Introduction
    </a></li>    <li class="">
    <a href="../../UserManual/Index.html">
        User Manual
    </a></li>    <li class="">
    <a href="../../Administration/Index.html">
        Administration
    </a></li>    <li class=" active">
    <a href="../Index.html">
        Configuration
    </a>        <ul class="menu-level-1"><li class="">
    <a href="../Settings/Index.html">
        Settings
    </a></li><li class="">
    <a href="../View/Index.html">
        View
    </a></li><li class="">
    <a href="../Persistence/Index.html">
        Persistence
    </a></li><li class="">
    <a href="../Validation/Index.html">
        Validation
    </a></li><li class="">
    <a href="../Geocoding/Index.html">
        Geocoding provider
    </a></li><li class=" current active">
    <a href="#" aria-current="page">
        Event listener
    </a></li></ul></li>    <li class="">
    <a href="../../Templating/Index.html">
        Templating
    </a></li>    <li class="">
    <a href="../../Tutorial/Index.html">
        Tutorial
    </a>        <ul class="menu-level-1"><li class="">
    <a href="../../Tutorial/Installation/Index.html">
        Installation
    </a></li><li class="">
    <a href="../../Tutorial/CustomEventListener/Index.html">
        Custom Event Listener
    </a></li><li class="">
    <a href="../../Tutorial/HeadlessMap/Index.html">
        Headless Map Rendering
    </a></li></ul></li>    <li class="">
    <a href="../../ImportCommand/Index.html">
        Import command
    </a></li>    <li class="">
    <a href="../../Deprecation/Index.html">
        Deprecation
    </a></li>    <li class="">
    <a href="../../BreakingChanges/Index.html">
        Breaking Changes
    </a></li>    </ul>
    <ul class="menu-level-1">
    <li class="">
    <a href="../../Sitemap.html">
        Sitemap
    </a></li>    </ul>
    </div>
    <div aria-label="Meta navigation" class="main_menu  d-block d-lg-none" role="navigation">
    <hr/>
    <p class="caption">Contributors Corner</p>
    <ul class="menu-level-1">            <li><a href="../../_sources/Configuration/EventListener/Index.rst.txt" rel="nofollow noopener" target="_blank">
                    View source of current document
            </a></li>
                    <li><a href="https://docs.typo3.org/m/typo3/docs-how-to-document/main/en-us/WritingDocsOfficial/GithubMethod.html" rel="nofollow noopener" target="_blank">
                    How to edit
            </a></li>
        </ul>
</div>
                        </div>
                    </div>
                </nav>
            </div>
            <div class="page-main-content">
                <div class="rst-content">                        <nav aria-label="breadcrumbs navigation" class="breadcrumb-bar" role="navigation">
        
<ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="../../Index.html">Store finder</a></li>
        <li class="breadcrumb-item"><a href="../Index.html">Configuration</a></li>
                    <li aria-current="page"  class="breadcrumb-item  active">Event listener</li>
        </ol>
        <div class="breadcrumb-additions">    <a class="btn btn-sm btn-light" href="../../_sources/Configuration/EventListener/Index.rst.txt" rel="nofollow noopener" target="_blank">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
        <a class="btn btn-sm btn-light" href="https://docs.typo3.org/m/typo3/docs-how-to-document/main/en-us/WritingDocsOfficial/GithubMethod.html" id="btnHowToEdit" rel="nofollow noopener" target="_blank">
        <span class="btn-icon"><span class="fas fa-info-circle"></span></span>
        <span class="btn-text">How to edit</span>
    </a>
    </div>    </nav>
                    
<article class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
    <div itemprop="articleBody">
        <!-- content start -->
                
<section class="section" id="event-listener" data-rst-anchor="eventlistener">
            <a id="eventlistener"></a>
            <h1>Event listener<a class="headerlink" href="#event-listener" data-bs-toggle="modal" data-bs-target="#linkReferenceModal"  title="Reference this headline"><i class="fa-solid fa-paragraph"></i></a></h1>
            <section class="section" id="introduction">
            <h2>Introduction<a class="headerlink" href="#introduction" data-bs-toggle="modal" data-bs-target="#linkReferenceModal"  title="Reference this headline"><i class="fa-solid fa-paragraph"></i></a></h2>
            
    <p>It is possible to use various custom event listener to use custom location loading logic. If you need
a modified sorting or locations based on other constraints then the provided, it is possible to override
the loading completly.</p>

    </section>
            <section class="section" id="adding-event-listeners">
            <h2>Adding event listeners<a class="headerlink" href="#adding-event-listeners" data-bs-toggle="modal" data-bs-target="#linkReferenceModal"  title="Reference this headline"><i class="fa-solid fa-paragraph"></i></a></h2>
            
    <p>Add the following code to the Configuration/Services.yaml of your sitepackage to use the example listener.</p>

                <div class="code-block-caption">
        <span class="caption-text">MapGetLocationsByConstraintsEventListener.php</span>
    </div><div class="code-block-wrapper" translate="no">
            
    <pre class="code-block"><code class="hljs php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Evoweb</span>\<span class="hljs-title">StoreFinder</span>\<span class="hljs-title">EventListener</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Evoweb</span>\<span class="hljs-title">StoreFinder</span>\<span class="hljs-title">Controller</span>\<span class="hljs-title">Event</span>\<span class="hljs-title">MapGetLocationsByConstraintsEvent</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">TYPO3</span>\<span class="hljs-title">CMS</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Attribute</span>\<span class="hljs-title">AsEventListener</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MapGetLocationsByConstraintsEventListener</span>
</span>{
   <span class="hljs-comment">#[AsEventListener('storefinder_mapcontroller_locationsfetched', MapGetLocationsByConstraintsEvent::class)]</span>
   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span><span class="hljs-params">(MapGetLocationsByConstraintsEvent $event)</span>: <span class="hljs-title">void</span>
   </span>{
   }
}</code></pre>
    <div>        <button class="code-block-copy" title="Copy to clipboard">
            <i class="icon fa-regular fa-copy code-block-copy-icon"></i>
            <i class="fa-solid fa-check code-block-check-icon code-block-hide"></i>
        </button>
        <span class="code-block-check-tooltip code-block-hide" aria-live="polite">Copied!</span>
    </div>
</div>
            
    <p>More explanation for your custom event listener can be found in the <code class="code-inline" translate="no">tutorial &lt;_<wbr>custom<wbr>Event<wbr>Listener&gt;</code></p>

    </section>
            <section class="section" id="additional-configuration">
            <h2>Additional configuration<a class="headerlink" href="#additional-configuration" data-bs-toggle="modal" data-bs-target="#linkReferenceModal"  title="Reference this headline"><i class="fa-solid fa-paragraph"></i></a></h2>
            <section class="section" id="performance-improvement">
            <h3>Performance improvement<a class="headerlink" href="#performance-improvement" data-bs-toggle="modal" data-bs-target="#linkReferenceModal"  title="Reference this headline"><i class="fa-solid fa-paragraph"></i></a></h3>
            
    <p>When using event listeners it&#039;s adviced to set typoscript setup
<code class="code-inline" translate="no">plugin.<wbr>tx_<wbr>storefinder.<wbr>settings.<wbr>disable<wbr>Location<wbr>Fetch<wbr>Logic = 1</code>
to improve performance. By doing so, all default fetching will be disabled.</p>

                <div class="code-block-caption">
        <span class="caption-text">EXT:my_extension/Configuration/TypoScript/setup.typoscript</span>
    </div><div class="code-block-wrapper" translate="no">
            
    <pre class="code-block"><code class="hljs typoscript">plugin.tx_storefinder.settings.disableLocationFetchLogic = 1</code></pre>
    <div>        <button class="code-block-copy" title="Copy to clipboard">
            <i class="icon fa-regular fa-copy code-block-copy-icon"></i>
            <i class="fa-solid fa-check code-block-check-icon code-block-hide"></i>
        </button>
        <span class="code-block-check-tooltip code-block-hide" aria-live="polite">Copied!</span>
    </div>
</div>
            
    <p>Listener must follow the symfony/event concept [<a href="https://symfony.com/doc/current/event_dispatcher.html">https://symfony.com/doc/current/event_dispatcher.html</a>]</p>

    </section>
            <section class="section" id="radius-not-automatically-detected">
            <h3>Radius not automatically detected<a class="headerlink" href="#radius-not-automatically-detected" data-bs-toggle="modal" data-bs-target="#linkReferenceModal"  title="Reference this headline"><i class="fa-solid fa-paragraph"></i></a></h3>
            
    <p>If you use a custom location loading mechanism, the location::distance property will be emtpy. Atleast if you do not
fill them on your own. In case the distance is empty the default zoom level detection has nothing to work with. In
this case, you need to set the zoom level in the template OR the radius in TypoScript</p>

                <div class="code-block-caption">
        <span class="caption-text">EXT:my_extension/Configuration/TypoScript/setup.typoscript</span>
    </div><div class="code-block-wrapper" translate="no">
            
    <pre class="code-block"><code class="hljs typoscript">plugin.tx_storefinder.settings.defaultConstraint.radius = 20</code></pre>
    <div>        <button class="code-block-copy" title="Copy to clipboard">
            <i class="icon fa-regular fa-copy code-block-copy-icon"></i>
            <i class="fa-solid fa-check code-block-check-icon code-block-hide"></i>
        </button>
        <span class="code-block-check-tooltip code-block-hide" aria-live="polite">Copied!</span>
    </div>
</div>
    </section>
    </section>
            <section class="section" id="modify-locations-in-storefindermiddleware">
            <h2>Modify locations in StoreFinderMiddleware<a class="headerlink" href="#modify-locations-in-storefindermiddleware" data-bs-toggle="modal" data-bs-target="#linkReferenceModal"  title="Reference this headline"><i class="fa-solid fa-paragraph"></i></a></h2>
            
    <p>It&#039;s possible to change locations records from store finder middleware before
sending the json response. Use the ModifyMiddlewareLocationsListener as an
example of how to change values.</p>

            
    <p>The registration got simplified in TYPO3 13.x</p>

    </section>
    </section>
        <!-- content end -->
    </div>
</article>
                        
            <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center"><li class="page-item">
                            <a class="page-link" href="../Geocoding/Index.html"
                               title="Accesskey Alt(+Shift)+p">
                                Previous
                            </a>
                        </li>
                    <li class="page-item">
                            <a class="page-link" href="../../Templating/Index.html"
                               title="Accesskey Alt(+Shift)+n">
                                Next
                            </a>
                        </li>
                    </ul>
        </nav>
                    </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="linkReferenceModal" tabindex="-1" aria-labelledby="linkReferenceModalLabel"
    aria-hidden="true" data-current-filename="Configuration/EventListener/Index">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="linkReferenceModalLabel">Reference to the headline</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-success d-none" id="permalink-alert-success" role="alert"></div>
                <div class="mb-3">
                    <label for="permalink-uri" class="col-form-label">Permalink</label>
                    <div class="input-group">
                        <input class="form-control code" id="permalink-uri" readonly>
                        <button type="button" class="btn btn-outline-secondary copy-button" data-target="permalink-uri"><i class="far fa-clone"></i></button>
                    </div>
                    <p>Copy and freely share the link</p>
                </div>
                <div class="mb-3">
                    <div class="alert alert-warning alert-permalink-rst" role="alert">This link target has no permanent anchor assigned.The link below can be used, but is prone to change if the page gets moved.
                    </div>
                    <label for="permalink-rst" class="col-form-label">reStructuredText (reST):</label>
                    <div class="input-group">
                        <textarea class="form-control code" id="permalink-rst" readonly></textarea>
                        <button type="button" class="btn btn-outline-secondary copy-button" data-target="permalink-rst"><i class="far fa-clone"></i></button>
                    </div>
                    <p>Copy this link into your TYPO3 manual. </p>
                </div>
                <div class="mb-3">
                    <label for="permalink-html" class="col-form-label">HTML:</label>
                    <div class="input-group">
                        <textarea class="form-control code" id="permalink-html" readonly></textarea>
                        <button type="button" class="btn btn-outline-secondary copy-button" data-target="permalink-html"><i class="far fa-clone"></i></button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>    <div class="modal fade" id="generalModal" tabindex="-1" aria-labelledby="linkReferenceModalLabel"
    aria-hidden="true" data-current-filename="Configuration/EventListener/Index"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="generalModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-success d-none" id="general-alert-success" role="alert"></div>
                <div id="generalModalContent">
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <div id="generalModalCustomButtons"></div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fa-regular fa-circle-xmark"></i>&nbsp;Close</button>
            </div>
        </div>
    </div>
</div></div>


<footer class="page-footer">
    <div class="frame frame-ruler-before frame-background-dark">
        <div class="frame-container">
            <div class="frame-inner">
                                <div class="footer-additional">
                    <p class="text-center">Last rendered: Oct 03, 2024 11:16</p>
                </div>
                <div class="footer-meta">
                    <ul class="footer-meta-navigation">
                        <li><a href="https://typo3.org/legal-notice" rel="nofollow" target="_blank" title="Legal Notice">Legal Notice</a></li>
                        <li><a href="https://typo3.org/privacy-policy" rel="nofollow" target="_blank" title="Privacy Policy">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>
<script src="../../_resources/js/popper.min.js"></script>
<script src="../../_resources/js/bootstrap.min.js"></script>
<script src="../../_resources/js/theme.min.js"></script>

<!--
 Locally rendered. No tracking embedded.
-->
</body>
</html>